import{r as e,a as t}from"./react-vendor-to62VX5h.js";import{c as r}from"./supabase-vendor-CcWUmFbe.js";import{U as s,X as a,B as i,C as l,a as n,L as d,D as o,S as c,b as m}from"./ui-vendor-qIErlyVs.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var x={exports:{}},u={},h=e,b=Symbol.for("react.element"),g=Symbol.for("react.fragment"),p=Object.prototype.hasOwnProperty,f=h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,y={key:!0,ref:!0,__self:!0,__source:!0};function j(e,t,r){var s,a={},i=null,l=null;for(s in void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(l=t.ref),t)p.call(t,s)&&!y.hasOwnProperty(s)&&(a[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===a[s]&&(a[s]=t[s]);return{$$typeof:b,type:e,key:i,ref:l,props:a,_owner:f.current}}u.Fragment=g,u.jsx=j,u.jsxs=j,x.exports=u;var v,N=x.exports,w=t;v=w.createRoot,w.hydrateRoot;const _=r("https://anyopnttxzcnepjjmwph.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFueW9wbnR0eHpjbmVwamptd3BoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMTYxMjQsImV4cCI6MjA3NzU5MjEyNH0.zx6uawextc3QAI06SClijnASiBV6eal-mda3WEAZ4Yg");async function S(){const{data:{user:e}}=await _.auth.getUser();if(!e)return null;const{data:t,error:r}=await _.from("staff").select("*").eq("id",e.id).maybeSingle();if(r)throw r;return t}const k=e.createContext(void 0);function I({children:t}){const[r,s]=e.useState(null),[a,i]=e.useState(null),[l,n]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const{data:{user:e}}=await _.auth.getUser();if(i(e||null),e){const e=await S();s(e)}}catch(e){console.error("Auth initialization error:",e)}finally{n(!1)}})();const{data:{subscription:e}}=_.auth.onAuthStateChange(async(e,t)=>{if(null==t?void 0:t.user){i(t.user);try{const e=await S();s(e)}catch(r){console.error("Error fetching user:",r)}}else i(null),s(null)});return()=>{null==e||e.unsubscribe()}},[]);return N.jsx(k.Provider,{value:{user:r,authUser:a,loading:l,signIn:async(e,t)=>{const{error:r}=await _.auth.signInWithPassword({email:e,password:t});if(r)throw r},signOut:async()=>{const{error:e}=await _.auth.signOut();if(e)throw e;s(null),i(null)}},children:t})}function C(){const t=e.useContext(k);if(void 0===t)throw new Error("useAuth must be used within AuthProvider");return t}function T(){const{signIn:t}=C(),[r,a]=e.useState(""),[i,l]=e.useState(""),[n,d]=e.useState(""),[o,c]=e.useState(!1);return N.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-lime-50 flex items-center justify-center p-4",children:N.jsxs("div",{className:"w-full max-w-md",children:[N.jsxs("div",{className:"backdrop-blur-lg bg-white/80 rounded-3xl shadow-2xl p-8 border border-white/20",children:[N.jsx("div",{className:"flex justify-center mb-8",children:N.jsx("div",{className:"p-4 bg-gradient-to-br from-emerald-500 to-lime-500 rounded-2xl",children:N.jsx(s,{className:"w-8 h-8 text-white"})})}),N.jsx("h1",{className:"text-3xl font-semibold text-center text-gray-900 mb-2",children:"Bhairuha OMS"}),N.jsx("p",{className:"text-center text-gray-600 mb-8",children:"Order Management System"}),N.jsxs("form",{onSubmit:async e=>{e.preventDefault(),d(""),c(!0);try{await t(r,i)}catch(s){d(s instanceof Error?s.message:"Login failed")}finally{c(!1)}},className:"space-y-6 mb-8",children:[N.jsxs("div",{children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),N.jsx("input",{type:"email",value:r,onChange:e=>a(e.target.value),placeholder:"Enter email",className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-emerald-500 focus:outline-none transition bg-gray-50 text-gray-900",disabled:o})]}),N.jsxs("div",{children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),N.jsx("input",{type:"password",value:i,onChange:e=>l(e.target.value),placeholder:"Enter password",className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-emerald-500 focus:outline-none transition bg-gray-50 text-gray-900",disabled:o})]}),n&&N.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm",children:n}),N.jsx("button",{type:"submit",disabled:o,className:"w-full py-3 bg-gradient-to-r from-emerald-500 to-lime-500 hover:from-emerald-600 hover:to-lime-600 disabled:opacity-50 text-white font-semibold rounded-xl transition transform hover:scale-105",children:o?"Signing in...":"Sign In"})]}),N.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[N.jsx("p",{className:"text-sm text-gray-600 font-medium mb-4",children:"Demo Credentials"}),N.jsx("div",{className:"space-y-3",children:[{email:"server@bhairuha.local",password:"password",role:"Server"},{email:"kitchen@bhairuha.local",password:"password",role:"Kitchen"},{email:"admin@bhairuha.local",password:"password",role:"Admin"}].map(e=>N.jsxs("button",{type:"button",onClick:()=>{return t=e.email,r=e.password,a(t),void l(r);var t,r},className:"w-full p-3 text-left bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 rounded-xl border border-gray-200 hover:border-gray-300 transition",children:[N.jsx("div",{className:"font-medium text-gray-900",children:e.role}),N.jsx("div",{className:"text-xs text-gray-500",children:e.email})]},e.email))})]})]}),N.jsxs("div",{className:"mt-8 text-center text-gray-600 text-sm",children:[N.jsx("p",{children:"Premium Real-time Order Management"}),N.jsx("p",{className:"text-gray-400 mt-2",children:"Synchronized across all devices"})]})]})})}function E(){const{user:t}=C(),[r,s]=e.useState([]),[l,n]=e.useState(0),[d,o]=e.useState(!1);e.useEffect(()=>{if(!t)return;!async function(){if(!t)return;const{data:e}=await _.from("notifications").select("*").or(`recipient_id.eq.${t.id},and(recipient_id.is.null,recipient_role.eq.${t.role})`).order("created_at",{ascending:!1}).limit(50);e&&(s(e.map(e=>({...e,display:!1}))),n(e.filter(e=>!e.is_read).length))}();const e=_.channel(`notifications-${t.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications"},async e=>{const r=e.new,a=e.old;(r.recipient_id===t.id||null===r.recipient_id&&r.recipient_role===t.role)&&r.created_at!==(null==a?void 0:a.created_at)&&(s(e=>[{...r,display:!0},...e]),n(e=>e+1),c(),setTimeout(()=>{s(e=>e.map(e=>e.id===r.id?{...e,display:!1}:e))},5e3))}).subscribe();return()=>{_.removeChannel(e)}},[t]);const c=()=>{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),r=e.createGain();t.connect(r),r.connect(e.destination),t.frequency.value=800,r.gain.setValueAtTime(.3,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),t.start(e.currentTime),t.stop(e.currentTime+.1)},m=r.filter(e=>e.display);return N.jsxs("div",{className:"fixed z-40",children:[N.jsx("div",{className:"fixed top-4 right-4 space-y-2 pointer-events-none",children:m.map(e=>N.jsx("div",{className:"pointer-events-auto bg-white/95 backdrop-blur-lg rounded-xl shadow-lg p-4 border border-white/20 max-w-xs animate-in slide-in-from-top-2 duration-300",children:N.jsxs("div",{className:"flex gap-3",children:[N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"font-semibold text-gray-900",children:e.title}),N.jsx("p",{className:"text-sm text-gray-600",children:e.message})]}),N.jsx("button",{onClick:()=>{return t=e.id,void s(e=>e.filter(e=>e.id!==t));var t},className:"text-gray-400 hover:text-gray-600",children:N.jsx(a,{className:"w-4 h-4"})})]})},e.id))}),N.jsxs("div",{className:"fixed top-4 left-4 pointer-events-auto",children:[N.jsxs("button",{onClick:()=>o(!d),className:"relative p-3 rounded-xl bg-white/80 backdrop-blur-lg hover:bg-white border border-white/20 hover:border-white/40 transition",children:[N.jsx(i,{className:"w-5 h-5 text-gray-700"}),l>0&&N.jsx("div",{className:"absolute top-0 right-0 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:Math.min(l,9)})]}),d&&N.jsxs("div",{className:"absolute top-14 left-0 w-80 bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl border border-white/20 max-h-96 overflow-y-auto mt-2",children:[N.jsx("div",{className:"p-4 border-b border-gray-200",children:N.jsx("h3",{className:"font-semibold text-gray-900",children:"Notifications"})}),0===r.length?N.jsx("div",{className:"p-8 text-center text-gray-500",children:"No notifications"}):N.jsx("div",{className:"divide-y divide-gray-100",children:r.map(e=>N.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer transition",children:N.jsxs("div",{className:"flex gap-3",children:[N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"font-medium text-gray-900",children:e.title}),N.jsx("p",{className:"text-sm text-gray-600",children:e.message}),N.jsx("p",{className:"text-xs text-gray-400 mt-1",children:new Date(e.created_at).toLocaleTimeString()})]}),!e.is_read&&N.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full mt-1"})]})},e.id))})]})]})]})}function q(t,r,s=[]){const[a,i]=e.useState([]),[l,n]=e.useState(!0),[d,o]=e.useState(null);return e.useEffect(()=>{let e=null;return async function(){try{n(!0);let s=_.from(t).select("*");const{data:a,error:l}=await s;if(l)throw l;i(a),e=_.channel(`${t}-changes`).on("postgres_changes",{event:"*",schema:"public",table:t,...r&&{filter:`${r.column}=eq.${r.value}`}},e=>{"INSERT"===e.eventType?i(t=>[...t,e.new]):"UPDATE"===e.eventType?i(t=>t.map(t=>t.id===e.new.id?e.new:t)):"DELETE"===e.eventType&&i(t=>t.filter(t=>t.id!==e.old.id))}).subscribe(),o(null)}catch(s){o(s instanceof Error?s:new Error("Unknown error"))}finally{n(!1)}}(),()=>{e&&_.removeChannel(e)}},s),{data:a,loading:l,error:d}}async function O(e,t,r,s,a,i){const{error:l}=await _.from("notifications").insert({recipient_role:e,recipient_id:i||null,type:t,title:r,message:s,reference_id:a||null,is_read:!1});if(l)throw l}function A(){var t;const{user:r}=C(),{data:s}=q("tables"),{data:i}=q("menu_items"),[l,n]=e.useState(null),[d,o]=e.useState(!1),[c,m]=e.useState([]),[x,u]=e.useState("Appetizers"),[h,b]=e.useState(!1),g=Array.from(new Set(i.map(e=>e.category))).sort(),p=i.filter(e=>e.category===x&&e.is_available),f=(e,t)=>{m(0===t?c.filter(t=>t.itemId!==e):c.map(r=>r.itemId===e?{...r,quantity:t}:r))};return N.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-lime-50 p-4",children:[N.jsxs("div",{className:"max-w-6xl mx-auto",children:[N.jsxs("div",{className:"mb-8",children:[N.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:"Tables"}),N.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your tables and orders"})]}),N.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:s.map(e=>{return N.jsxs("button",{onClick:()=>{n(e.id),o(!0)},className:"p-6 rounded-2xl backdrop-blur-lg bg-white/80 border border-white/20 hover:border-white/40 transition transform hover:scale-105 "+(t=e.status,"occupied"===t||"active"===t?"ring-2 ring-emerald-400 shadow-lg shadow-emerald-200":"ring-1 ring-gray-200"),children:[N.jsx("div",{className:"text-4xl font-bold text-gray-900 mb-2",children:e.table_number}),N.jsx("div",{className:"text-sm font-medium "+("free"===e.status?"text-gray-500":"occupied"===e.status?"text-emerald-600":"text-emerald-600 animate-pulse"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]},e.id);var t})})]}),d&&l&&N.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-end md:items-center justify-center p-4",children:N.jsxs("div",{className:"w-full max-w-2xl bg-white/95 backdrop-blur-lg rounded-3xl shadow-2xl border border-white/20 max-h-[90vh] overflow-y-auto md:rounded-3xl",children:[N.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-emerald-50 to-lime-50 p-6 border-b border-gray-200 flex items-center justify-between",children:[N.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Table ",null==(t=s.find(e=>e.id===l))?void 0:t.table_number]}),N.jsx("button",{onClick:()=>{o(!1),n(null),m([])},className:"p-2 hover:bg-white/50 rounded-lg transition",children:N.jsx(a,{className:"w-6 h-6 text-gray-600"})})]}),N.jsxs("div",{className:"p-6",children:[N.jsxs("div",{className:"mb-6",children:[N.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Categories"}),N.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(e=>N.jsx("button",{onClick:()=>u(e),className:"px-4 py-2 rounded-lg font-medium transition "+(x===e?"bg-emerald-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e},e))})]}),N.jsxs("div",{className:"mb-6",children:[N.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Menu Items"}),N.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-64 overflow-y-auto",children:p.map(e=>{const t=c.find(t=>t.itemId===e.id);return N.jsxs("button",{onClick:()=>(e=>{const t=c.find(t=>t.itemId===e);m(t?c.map(t=>t.itemId===e?{...t,quantity:t.quantity+1}:t):[...c,{itemId:e,quantity:1,notes:""}])})(e.id),className:"p-3 text-left bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 transition flex items-center justify-between",children:[N.jsxs("div",{children:[N.jsx("p",{className:"font-medium text-gray-900",children:e.name}),N.jsxs("p",{className:"text-sm text-gray-600",children:["₹",e.price]})]}),t&&N.jsx("div",{className:"bg-emerald-500 text-white px-3 py-1 rounded-lg font-medium",children:t.quantity})]},e.id)})})]}),c.length>0&&N.jsxs("div",{className:"mb-6",children:[N.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Selected Items"}),N.jsx("div",{className:"space-y-3 max-h-40 overflow-y-auto",children:c.map(e=>{const t=i.find(t=>t.id===e.itemId);return N.jsxs("div",{className:"p-3 bg-emerald-50 rounded-lg border border-emerald-200",children:[N.jsxs("div",{className:"flex items-center justify-between mb-2",children:[N.jsx("p",{className:"font-medium text-gray-900",children:null==t?void 0:t.name}),N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("button",{onClick:()=>f(e.itemId,e.quantity-1),className:"px-2 py-1 bg-white rounded border border-gray-200 hover:bg-gray-50",children:"−"}),N.jsx("span",{className:"px-3 font-medium",children:e.quantity}),N.jsx("button",{onClick:()=>f(e.itemId,e.quantity+1),className:"px-2 py-1 bg-white rounded border border-gray-200 hover:bg-gray-50",children:"+"})]})]}),N.jsx("input",{type:"text",placeholder:"Add notes (e.g., extra spicy, no ice)",value:e.notes,onChange:t=>{return r=e.itemId,s=t.target.value,void m(c.map(e=>e.itemId===r?{...e,notes:s}:e));var r,s},className:"w-full px-3 py-2 bg-white rounded border border-gray-200 focus:border-emerald-500 outline-none text-sm"})]},e.itemId)})})]}),N.jsxs("div",{className:"flex gap-3",children:[N.jsx("button",{onClick:()=>{o(!1),n(null),m([])},className:"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-900 font-semibold rounded-xl transition",children:"Cancel"}),N.jsx("button",{onClick:async()=>{if(l&&0!==c.length&&r){b(!0);try{const e=s.find(e=>e.id===l);if(!e)throw new Error("Table not found");const{data:t,error:a}=await _.from("orders").select("*").eq("table_id",l).neq("status","billed").maybeSingle();if(a)throw a;let i;if(t)i=t.id;else{const{data:t,error:s}=await _.from("orders").insert({table_id:l,server_id:r.id,status:"pending"}).select("id").single();if(s)throw s;i=t.id,await _.from("tables").update({status:"active",current_server_id:r.id}).eq("id",l),await async function(e,t,r){await O("kitchen","order_created",`New Order: Table ${t}`,`${r} placed a new order`,e)}(i,e.table_number,r.full_name)}for(const r of c){const{error:e}=await _.from("order_items").insert({order_id:i,menu_item_id:r.itemId,quantity:r.quantity,notes:r.notes||null,status:"pending"});if(e)throw e}await _.from("audit_log").insert({user_id:r.id,user_role:r.role,action:"order_items_added",entity_type:"order",entity_id:i,details:{items_count:c.length}}),m([]),o(!1),n(null)}catch(e){console.error("Error submitting order:",e)}finally{b(!1)}}},disabled:0===c.length||h,className:"flex-1 px-4 py-3 bg-gradient-to-r from-emerald-500 to-lime-500 hover:from-emerald-600 hover:to-lime-600 disabled:opacity-50 text-white font-semibold rounded-xl transition",children:h?"Submitting...":`Submit Order (${c.length})`})]})]})]})})]})}function M(){const{user:t}=C(),{data:r}=q("orders"),{data:s}=q("tables"),{data:a}=q("order_items"),{data:i}=q("menu_items"),{data:d}=q("staff"),[o,c]=e.useState("table-wise"),[m,x]=e.useState(!1),u=r.filter(e=>["pending","in_progress","prepared"].includes(e.status)).map(e=>({...e,table:s.find(t=>t.id===e.table_id),server:d.find(t=>t.id===e.server_id),order_items:a.filter(t=>t.order_id===e.id).map(e=>({...e,menu_item:i.find(t=>t.id===e.menu_item_id)})).filter(e=>e.menu_item)})).filter(e=>e.table&&e.server&&e.order_items.length>0),h=e=>{switch(e){case"pending":return"bg-red-50 border-red-200 text-red-700";case"in_progress":return"bg-yellow-50 border-yellow-200 text-yellow-700";case"prepared":return"bg-green-50 border-green-200 text-green-700";default:return"bg-gray-50 border-gray-200 text-gray-700"}},b=(e,l)=>{const n="pending"===e?"in_progress":"in_progress"===e?"prepared":null;return n?N.jsx("button",{onClick:()=>(async(e,l)=>{if(t){x(!0);try{const{error:n}=await _.from("order_items").update({status:l}).eq("id",e);if(n)throw n;if("prepared"===l){const t=a.find(t=>t.id===e);if(t){const a=r.find(e=>e.id===t.order_id),l=i.find(e=>e.id===t.menu_item_id),n=s.find(e=>e.id===(null==a?void 0:a.table_id));a&&l&&n&&await O("server","item_prepared",`${l.name} Ready`,`Table ${n.table_number} - ${l.name} is prepared`,e,a.server_id)}}await _.from("audit_log").insert({user_id:t.id,user_role:t.role,action:`item_${l}`,entity_type:"order_item",entity_id:e})}catch(n){console.error("Error updating item status:",n)}finally{x(!1)}}})(l,n),disabled:m,className:`px-3 py-1 rounded text-sm font-medium transition ${"in_progress"===n?"bg-yellow-500 hover:bg-yellow-600 text-white":"bg-green-500 hover:bg-green-600 text-white"} disabled:opacity-50`,children:"in_progress"===n?"Start":"Mark Ready"}):null};return N.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-lime-50 p-4",children:N.jsxs("div",{className:"max-w-7xl mx-auto",children:[N.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[N.jsxs("div",{children:[N.jsxs("h1",{className:"text-4xl font-bold text-gray-900 flex items-center gap-3",children:[N.jsx(l,{className:"w-10 h-10 text-emerald-600"}),"Kitchen"]}),N.jsx("p",{className:"text-gray-600 mt-1",children:"Manage food preparation"})]}),N.jsxs("div",{className:"flex gap-2 bg-white/80 backdrop-blur-lg rounded-lg p-1 border border-white/20",children:[N.jsx("button",{onClick:()=>c("table-wise"),className:"px-4 py-2 rounded font-medium transition "+("table-wise"===o?"bg-emerald-500 text-white":"text-gray-700 hover:bg-gray-100"),children:"Table Wise"}),N.jsx("button",{onClick:()=>c("item-wise"),className:"px-4 py-2 rounded font-medium transition "+("item-wise"===o?"bg-emerald-500 text-white":"text-gray-700 hover:bg-gray-100"),children:"Item Wise"})]})]}),"table-wise"===o?N.jsx("div",{className:"grid gap-4",children:0===u.length?N.jsx("div",{className:"p-12 text-center text-gray-500 bg-white/80 backdrop-blur-lg rounded-2xl border border-white/20",children:N.jsx("p",{className:"text-lg",children:"No active orders"})}):u.map(e=>{const t=new Date(e.created_at),r=Math.floor((Date.now()-t.getTime())/1e3),s=Math.floor(r/60),a=r%60;return N.jsxs("div",{className:"bg-white/80 backdrop-blur-lg rounded-2xl shadow-lg border border-white/20 overflow-hidden hover:shadow-xl transition",children:[N.jsxs("div",{className:"bg-gradient-to-r from-emerald-50 to-lime-50 p-4 border-b border-gray-200 flex items-center justify-between",children:[N.jsxs("div",{children:[N.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Table ",e.table.table_number]}),N.jsx("p",{className:"text-sm text-gray-600",children:e.server.full_name})]}),N.jsxs("div",{className:"flex items-center gap-2 text-gray-700 font-medium",children:[N.jsx(n,{className:"w-4 h-4"}),s,":",String(a).padStart(2,"0")]})]}),N.jsx("div",{className:"p-4 space-y-2",children:e.order_items.map(e=>N.jsxs("div",{className:`p-3 rounded-lg border flex items-center justify-between ${h(e.status)}`,children:[N.jsxs("div",{className:"flex-1",children:[N.jsxs("p",{className:"font-semibold",children:[e.quantity,"x ",e.menu_item.name]}),e.notes&&N.jsxs("p",{className:"text-sm opacity-75",children:["Note: ",e.notes]})]}),N.jsx("div",{className:"flex gap-2 ml-4",children:b(e.status,e.id)})]},e.id))})]},e.id)})}):N.jsx("div",{className:"grid gap-4",children:Array.from(new Map(u.flatMap(e=>e.order_items.map(t=>({...t,tableNumber:e.table.table_number,serverName:e.server.full_name}))).map(e=>[e.menu_item_id,e])).values()).map(e=>{const t=u.flatMap(t=>t.order_items.filter(t=>t.menu_item_id===e.menu_item_id).map(e=>({...e,tableNumber:t.table.table_number,serverName:t.server.full_name})));return N.jsxs("div",{className:"bg-white/80 backdrop-blur-lg rounded-2xl shadow-lg border border-white/20 p-4 overflow-hidden hover:shadow-xl transition",children:[N.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:[e.menu_item.name," (",t.length,")"]}),N.jsx("div",{className:"space-y-2",children:t.map(e=>N.jsxs("div",{className:`p-3 rounded-lg border flex items-center justify-between ${h(e.status)}`,children:[N.jsxs("div",{className:"flex-1",children:[N.jsxs("p",{className:"font-semibold",children:["Table ",e.tableNumber," - ",e.quantity,"x"]}),e.notes&&N.jsxs("p",{className:"text-sm opacity-75",children:["Note: ",e.notes]})]}),N.jsx("div",{className:"flex gap-2 ml-4",children:b(e.status,e.id)})]},e.id))})]},e.menu_item_id)})})]})})}function R(){const{user:t,signOut:r}=C(),{data:s}=q("tables"),{data:a}=q("orders"),{data:i}=q("order_items"),{data:l}=q("menu_items"),{data:n}=q("invoices"),{data:x}=q("staff"),[u,h]=e.useState("billing"),[b,g]=e.useState(!1),p=s.filter(e=>"served"===e.status),f=a.map(e=>({...e,table:s.find(t=>t.id===e.table_id),order_items:i.filter(t=>t.order_id===e.id).map(e=>({...e,menu_item:l.find(t=>t.id===e.menu_item_id)})).filter(e=>e.menu_item)})),y=async(e,r)=>{if(t){g(!0);try{const s=f.find(t=>t.table_id===e&&"billed"!==t.status);if(!s)throw new Error("Order not found");const a=s.order_items.reduce((e,t)=>e+t.menu_item.price*t.quantity,0),{error:i}=await _.from("invoices").insert({table_id:e,order_id:s.id,total_amount:a,payment_method:r,created_by:t.id});if(i)throw i;await _.from("orders").update({status:"billed"}).eq("id",s.id),await _.from("tables").update({status:"free",current_server_id:null}).eq("id",e),await _.from("audit_log").insert({user_id:t.id,user_role:t.role,action:"invoice_created",entity_type:"invoice",entity_id:e,details:{amount:a,payment_method:r}})}catch(s){console.error("Error generating invoice:",s)}finally{g(!1)}}},j=n.reduce((e,t)=>e+t.total_amount,0),v=n.filter(e=>new Date(e.created_at).toDateString()===(new Date).toDateString()),w=v.reduce((e,t)=>e+t.total_amount,0);return N.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-lime-50 p-4",children:N.jsxs("div",{className:"max-w-7xl mx-auto",children:[N.jsxs("div",{className:"flex items-center justify-between mb-8",children:[N.jsxs("div",{children:[N.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:"Admin Dashboard"}),N.jsx("p",{className:"text-gray-600 mt-1",children:"Restaurant management and control hub"})]}),N.jsx("button",{onClick:()=>r(),className:"p-3 rounded-lg bg-white/80 hover:bg-white border border-white/20 hover:border-white/40 transition",children:N.jsx(d,{className:"w-5 h-5 text-gray-700"})})]}),N.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[N.jsxs("div",{className:"bg-white/80 backdrop-blur-lg rounded-2xl p-6 border border-white/20",children:[N.jsx("p",{className:"text-gray-600 text-sm font-medium mb-2",children:"Today's Sales"}),N.jsxs("p",{className:"text-3xl font-bold text-emerald-600",children:["₹",w.toFixed(2)]}),N.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[v.length," invoices"]})]}),N.jsxs("div",{className:"bg-white/80 backdrop-blur-lg rounded-2xl p-6 border border-white/20",children:[N.jsx("p",{className:"text-gray-600 text-sm font-medium mb-2",children:"Total Sales"}),N.jsxs("p",{className:"text-3xl font-bold text-emerald-600",children:["₹",j.toFixed(2)]}),N.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[n.length," invoices"]})]}),N.jsxs("div",{className:"bg-white/80 backdrop-blur-lg rounded-2xl p-6 border border-white/20",children:[N.jsx("p",{className:"text-gray-600 text-sm font-medium mb-2",children:"Ready for Billing"}),N.jsx("p",{className:"text-3xl font-bold text-lime-600",children:p.length}),N.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"tables waiting"})]})]}),N.jsxs("div",{className:"bg-white/80 backdrop-blur-lg rounded-2xl border border-white/20 shadow-lg overflow-hidden",children:[N.jsxs("div",{className:"flex items-center gap-4 p-6 border-b border-gray-200",children:[N.jsxs("button",{onClick:()=>h("billing"),className:"px-4 py-2 font-medium rounded-lg transition "+("billing"===u?"bg-emerald-500 text-white":"text-gray-700 hover:bg-gray-100"),children:[N.jsx(o,{className:"w-4 h-4 inline mr-2"}),"Billing Queue"]}),N.jsxs("button",{onClick:()=>h("menu"),className:"px-4 py-2 font-medium rounded-lg transition "+("menu"===u?"bg-emerald-500 text-white":"text-gray-700 hover:bg-gray-100"),children:[N.jsx(c,{className:"w-4 h-4 inline mr-2"}),"Menu Management"]}),N.jsxs("button",{onClick:()=>h("staff"),className:"px-4 py-2 font-medium rounded-lg transition "+("staff"===u?"bg-emerald-500 text-white":"text-gray-700 hover:bg-gray-100"),children:[N.jsx(c,{className:"w-4 h-4 inline mr-2"}),"Staff Management"]}),N.jsxs("button",{onClick:()=>h("reports"),className:"px-4 py-2 font-medium rounded-lg transition "+("reports"===u?"bg-emerald-500 text-white":"text-gray-700 hover:bg-gray-100"),children:[N.jsx(m,{className:"w-4 h-4 inline mr-2"}),"Reports"]})]}),N.jsxs("div",{className:"p-6",children:["billing"===u&&N.jsx("div",{className:"space-y-4",children:0===p.length?N.jsx("p",{className:"text-gray-500 text-center py-8",children:"No tables ready for billing"}):p.map(e=>{const t=f.find(t=>t.table_id===e.id&&"served"===t.status);if(!t)return null;const r=t.order_items.reduce((e,t)=>e+t.menu_item.price*t.quantity,0);return N.jsxs("div",{className:"p-4 bg-gradient-to-r from-emerald-50 to-lime-50 rounded-lg border border-emerald-200 flex items-center justify-between",children:[N.jsxs("div",{children:[N.jsxs("p",{className:"font-semibold text-gray-900",children:["Table ",e.table_number]}),N.jsxs("p",{className:"text-sm text-gray-600",children:[t.order_items.length," items - ₹",r.toFixed(2)]})]}),N.jsxs("div",{className:"flex gap-2",children:[N.jsx("button",{onClick:()=>y(e.id,"cash"),disabled:b,className:"px-4 py-2 bg-green-500 hover:bg-green-600 disabled:opacity-50 text-white font-medium rounded-lg transition",children:"Cash"}),N.jsx("button",{onClick:()=>y(e.id,"upi"),disabled:b,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:opacity-50 text-white font-medium rounded-lg transition",children:"UPI"})]})]},e.id)})}),"menu"===u&&N.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:[N.jsxs("p",{className:"text-gray-600 mb-4",children:["Total menu items: ",l.length]}),l.map(e=>N.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 flex items-center justify-between",children:N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"font-semibold text-gray-900",children:e.name}),N.jsxs("div",{className:"flex gap-4 mt-1",children:[N.jsx("span",{className:"text-xs text-gray-600",children:e.category}),N.jsxs("span",{className:"text-xs text-gray-600",children:["₹",e.price]}),N.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded "+(e.is_available?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:e.is_available?"Available":"Unavailable"})]})]})},e.id))]}),"staff"===u&&N.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:[N.jsxs("p",{className:"text-gray-600 mb-4",children:["Total staff: ",x.length]}),x.map(e=>N.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 flex items-center justify-between",children:N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"font-semibold text-gray-900",children:e.full_name}),N.jsxs("div",{className:"flex gap-4 mt-1",children:[N.jsx("span",{className:"text-xs text-gray-600",children:e.email}),N.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded "+("server"===e.role?"bg-blue-100 text-blue-700":"kitchen"===e.role?"bg-orange-100 text-orange-700":"bg-purple-100 text-purple-700"),children:e.role})]})]})},e.id))]}),"reports"===u&&N.jsxs("div",{className:"space-y-6",children:[N.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[N.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[N.jsx("p",{className:"text-gray-600 text-sm mb-2",children:"Average Order Value"}),N.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["₹",n.length>0?(j/n.length).toFixed(2):"0"]})]}),N.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[N.jsx("p",{className:"text-gray-600 text-sm mb-2",children:"Total Transactions"}),N.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.length})]})]}),N.jsxs("div",{children:[N.jsx("p",{className:"font-semibold text-gray-900 mb-3",children:"Payment Methods"}),N.jsx("div",{className:"space-y-2",children:["cash","upi"].map(e=>{const t=n.filter(t=>t.payment_method===e).length,r=n.filter(t=>t.payment_method===e).reduce((e,t)=>e+t.total_amount,0);return N.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:N.jsxs("div",{className:"flex justify-between",children:[N.jsx("span",{className:"font-medium text-gray-900 capitalize",children:e}),N.jsxs("span",{className:"text-gray-600",children:["₹",r.toFixed(2)," (",t," orders)"]})]})},e)})})]})]})]})]})]})})}function $(){const{user:e,loading:t}=C();return t?N.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-lime-50 flex items-center justify-center",children:N.jsxs("div",{className:"text-center",children:[N.jsx("div",{className:"w-12 h-12 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin mx-auto mb-4"}),N.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):e?N.jsxs(N.Fragment,{children:[N.jsx(E,{}),"server"===e.role&&N.jsx(A,{}),"kitchen"===e.role&&N.jsx(M,{}),"admin"===e.role&&N.jsx(R,{})]}):N.jsx(T,{})}function D(){return N.jsx(I,{children:N.jsx($,{})})}v(document.getElementById("root")).render(N.jsx(e.StrictMode,{children:N.jsx(D,{})}));
